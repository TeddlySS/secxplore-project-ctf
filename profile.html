<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - secXplore</title>
    <link rel="stylesheet" href="profile.css">
</head>
<body>
    <!-- Cyber Grid Background -->
    <div class="cyber-grid"></div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="home.html" class="logo">
                <span>üîê</span>
                <span>secXplore</span>
            </a>
            <div class="nav-links">
                <a href="home.html" class="nav-link">Home</a>
                <a href="challenge.html" class="nav-link">Challenges</a>
                <a href="leaderboard.html" class="nav-link">Leaderboard</a>
                <a href="profile.html" class="nav-link profile-pill" id="navProfileBtn" style="display:none">
                    <img src="" alt="avatar" class="nav-avatar" id="navAvatar">
                    <span id="navUsername">@user</span>
                </a>
                <a href="login.html" class="nav-link" onclick="logout()">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Profile Container -->
    <div class="profile-container">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <img src="https://ui-avatars.com/api/?name=User&size=200&background=00ff88&color=0a0e27&bold=true" 
                         alt="Avatar" 
                         id="avatarPreview" 
                         class="avatar-image">
                    <div class="avatar-overlay">
                        <button class="change-avatar-btn" onclick="document.getElementById('avatarInput').click()">
                            üì∑ Change
                        </button>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarChange(event)">
                </div>
                <div class="user-info">
                    <h1 class="username" id="displayUsername">@username</h1>
                    <p class="user-role" id="userRole">User</p>
                    <div class="user-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="userScore">0</span>
                            <span class="stat-label">Score</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="userRank">#-</span>
                            <span class="stat-label">Rank</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="solvedChallenges">0</span>
                            <span class="stat-label">Solved</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Content -->
        <div class="profile-content">
            <!-- Account Information Section -->
            <section class="profile-section">
                <div class="section-header">
                    <h2>üë§ Account Information</h2>
                    <button class="btn-edit" id="editAccountBtn" onclick="toggleEditMode()">
                        ‚úèÔ∏è Edit
                    </button>
                </div>

                <form id="accountForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="username" class="form-input" value="username" disabled>
                            <small class="form-hint">Username cannot be changed</small>
                        </div>
                        <div class="form-group">
                            <label>Display Name</label>
                            <input type="text" id="displayName" class="form-input" value="User Name" disabled>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="email" class="form-input" value="user@example.com" disabled>
                        </div>
                        <div class="form-group">
                            <label>Member Since</label>
                            <input type="text" id="memberSince" class="form-input" value="October 28, 2025" disabled>
                        </div>
                    </div>

                    <div class="form-actions" id="accountActions" style="display: none;">
                        <button type="button" class="btn-primary" onclick="saveAccountChanges()">
                            üíæ Save Changes
                        </button>
                        <button type="button" class="btn-secondary" onclick="cancelEdit()">
                            ‚úñÔ∏è Cancel
                        </button>
                    </div>
                </form>
            </section>

            <!-- Security Section -->
            <section class="profile-section">
                <div class="section-header">
                    <h2>üîí Security</h2>
                </div>

                <div class="security-item">
                    <div class="security-info">
                        <h3>Password</h3>
                        <p>Last changed: 2 days ago</p>
                    </div>
                    <button class="btn-danger" onclick="openPasswordModal()">
                        üîë Reset Password
                    </button>
                </div>

                <div class="security-item">
                    <div class="security-info">
                        <h3>Two-Factor Authentication (2FA)</h3>
                        <p>Add an extra layer of security to your account</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="twoFactorToggle" onchange="toggle2FA()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </section>

            <!-- Danger Zone -->
            <section class="profile-section danger-zone">
                <div class="section-header">
                    <h2>‚ö†Ô∏è Danger Zone</h2>
                </div>
                <div class="danger-item">
                    <div>
                        <h3>Delete Account</h3>
                        <p>Permanently delete your account and all data</p>
                    </div>
                    <button class="btn-danger-outline" onclick="confirmDeleteAccount()">
                        Delete Account
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-backdrop" onclick="closePasswordModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîë Reset Password</h2>
                <button class="close-btn" onclick="closePasswordModal()">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Step 1: Verify Current Password -->
                <div id="step1" class="password-step active">
                    <p class="step-description">Enter your current password to continue</p>
                    
                    <div class="form-group">
                        <label>Current Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password">
                            <button type="button" class="toggle-password" onclick="togglePasswordField('currentPassword', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <button class="btn-primary btn-full" onclick="verifyCurrentPassword()">
                        Continue
                    </button>
                </div>

                <!-- Step 2: Email OTP Verification -->
                <div id="step2" class="password-step">
                    <p class="step-description">Enter the 6-digit code sent to <strong id="userEmail">user@example.com</strong></p>
                    
                    <div class="otp-input-group">
                        <input type="text" maxlength="1" class="otp-input" id="otp1" oninput="moveToNext(this, 'otp2')">
                        <input type="text" maxlength="1" class="otp-input" id="otp2" oninput="moveToNext(this, 'otp3')">
                        <input type="text" maxlength="1" class="otp-input" id="otp3" oninput="moveToNext(this, 'otp4')">
                        <input type="text" maxlength="1" class="otp-input" id="otp4" oninput="moveToNext(this, 'otp5')">
                        <input type="text" maxlength="1" class="otp-input" id="otp5" oninput="moveToNext(this, 'otp6')">
                        <input type="text" maxlength="1" class="otp-input" id="otp6">
                    </div>

                    <p class="otp-resend">
                        Didn't receive code? 
                        <a href="#" onclick="resendOTP(); return false;">Resend OTP</a>
                        <span id="otpTimer"></span>
                    </p>

                    <button class="btn-primary btn-full" onclick="verifyOTP()">
                        Verify Code
                    </button>
                </div>

                <!-- Step 3: New Password -->
                <div id="step3" class="password-step">
                    <p class="step-description">Create your new password</p>
                    
                    <div class="form-group">
                        <label>New Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                            <button type="button" class="toggle-password" onclick="togglePasswordField('newPassword', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <div class="password-strength" id="newPasswordStrength">
                            <div class="strength-indicator">
                                <div class="strength-bar" id="strengthBar"></div>
                            </div>
                            <span id="strengthText">Enter a password</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="confirmNewPassword" class="form-input" placeholder="Confirm new password">
                            <button type="button" class="toggle-password" onclick="togglePasswordField('confirmNewPassword', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <div class="password-match" id="passwordMatch"></div>
                    </div>

                    <button class="btn-primary btn-full" onclick="resetPassword()">
                        Reset Password
                    </button>
                </div>

                <!-- Success Step -->
                <div id="stepSuccess" class="password-step">
                    <div class="success-icon">‚úÖ</div>
                    <h3>Password Changed Successfully!</h3>
                    <p>Your password has been updated. Please use your new password to log in.</p>
                    <button class="btn-primary btn-full" onclick="closePasswordModal()">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div class="modal" id="deleteAccountModal">
        <div class="modal-backdrop" onclick="closeDeleteAccountModal()"></div>
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Delete Account</h2>
                <button class="close-btn" onclick="closeDeleteAccountModal()">&times;</button>
            </div>

            <div class="modal-body">
                <div class="warning-box">
                    <div class="warning-icon">üö®</div>
                    <h3>This action cannot be undone!</h3>
                    <p>Deleting your account will permanently remove:</p>
                    <ul class="warning-list">
                        <li>‚úó All your profile data</li>
                        <li>‚úó Your challenge progress</li>
                        <li>‚úó Your scores and achievements</li>
                        <li>‚úó Your leaderboard ranking</li>
                        <li>‚úó All associated data</li>
                    </ul>
                </div>

                <div class="form-group" style="margin-top: 2rem;">
                    <label>Enter your password to confirm deletion:</label>
                    <div class="password-input-wrapper">
                        <input type="password" 
                               id="deleteAccountPassword" 
                               class="form-input" 
                               placeholder="Enter your password">
                        <button type="button" class="toggle-password" onclick="togglePasswordField('deleteAccountPassword', this)">
                            <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Type <strong>"DELETE"</strong> to confirm:</label>
                    <input type="text" 
                           id="deleteConfirmText" 
                           class="form-input" 
                           placeholder="Type DELETE in capital letters"
                           autocomplete="off">
                </div>

                <div class="form-actions" style="margin-top: 2rem;">
                    <button type="button" class="btn-danger btn-full" onclick="executeDeleteAccount()">
                        üóëÔ∏è Permanently Delete Account
                    </button>
                    <button type="button" class="btn-secondary btn-full" onclick="closeDeleteAccountModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="profile.js"></script>
</body>
</html>
